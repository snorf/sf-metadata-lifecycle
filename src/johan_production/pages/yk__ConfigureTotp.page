<apex:page controller="yk.TotpController">
    <apex:pageMessages />
      <apex:pageBlock title="Setup Salesforce Authenticator">
      
      <apex:outputLabel rendered="{! isConfigured}">
      	Once you complete this setup, <b>the codes generated by your old Authenticator app will stop working</b>.
      </apex:outputLabel>
          
      <p>
        Please select your new phone type
      </p>
      <apex:form >
            <apex:selectRadio value="{!platform}">
                <apex:actionSupport event="onchange"                   
                                    rerender="config"/>
                <apex:selectOptions value="{!platforms}"/>
            </apex:selectRadio>
      </apex:form>
      
      <apex:outputPanel id="config">
          <apex:outputPanel rendered="{! platform != null}">
              <apex:outputPanel rendered="{! platform == 'other'}">
                  <p>
                      Scan the QR code below using an app compatible with <em>Salesforce Authenticator</em> or <em>TOTP</em>.
                  </p>
              </apex:outputPanel>
           
              <apex:outputPanel rendered="{! platform != 'other'}">
                  <p>Set up Salesforce Authenticator codes</p>
                  
                  <ol>
                      <li>Install Salesforce Authenticator on your phone.</li>
                      <li>Open the Salesforce Authenticator app.</li>
                      <li>In Salesforce Authenticator, tap "Add Your First Key".</li>
                      <li>Select "Scan a barcode".</li>
                      <li>Use your phones camera to scan this barcode.</li>
                  </ol>
              </apex:outputPanel>
          
              <apex:image value="{!qrCode}"/>
                  
              <p>
                  <em>If you don't see a QR-code, disable any content-blocking browser extensions.</em>
              </p>
                 
              <p>
                  Once you have scanned the barcode, enter the 6-digit verification code generated by the Authenticator app.
              </p>
           
              <apex:form >
                  <p>
                    <apex:inputText value="{!verificationOtp}" size="6" maxlength="6"/>
                    <apex:commandButton action="{!save}" value="Verify and Save"/>
                  </p>
              </apex:form>
          </apex:outputPanel>
      </apex:outputPanel>
  </apex:pageBlock>
</apex:page>